YOLO-NAS
YOLO-NASï¼ˆYou Only Look Once - Neural Architecture Searchï¼‰ã¯Deci.aiã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚ŒãŸé«˜é€Ÿãƒ»é«˜ç²¾åº¦ãªç‰©ä½“æ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚ä»¥ä¸‹ã«ã€YOLO-NASã‚’ä½¿ã£ãŸå­¦ç¿’ã¨æ¨è«–ã®æœ€å°é™ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚

â¸»

ğŸ”§ å‰ææ¡ä»¶
	â€¢	Python >= 3.8
	â€¢	GPU (æ¨å¥¨)
	â€¢	super-gradients ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼ˆYOLO-NASã®å…¬å¼ã‚µãƒãƒ¼ãƒˆï¼‰

pip install super-gradients


â¸»

ğŸ“ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆä¾‹: Pascal VOCãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰

dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ annotations/
â”œâ”€â”€ valid/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ annotations/

YOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚‚å¯ï¼ˆtxt + imagesï¼‰ã§ã™ã€‚

â¸»

ğŸ§  å­¦ç¿’ã‚³ãƒ¼ãƒ‰

from super_gradients.training import Trainer, dataloaders
from super_gradients.training.models import yolo_nas_l
from super_gradients.training.datasets.detection_datasets import COCOFormatDetectionDataset
from super_gradients.training.losses import PPYoloELoss
from super_gradients.training.metrics import DetectionMetrics

# ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã®åˆæœŸåŒ–
trainer = Trainer(experiment_name="yolo_nas_example")

# ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆè¨­å®šï¼ˆPascal VOC or YOLOå½¢å¼ï¼‰
train_dataset = COCOFormatDetectionDataset(
    data_dir="dataset/train", json_annotation_file="instances_train.json", dataset_classes=["person", "car"]
)

val_dataset = COCOFormatDetectionDataset(
    data_dir="dataset/valid", json_annotation_file="instances_valid.json", dataset_classes=["person", "car"]
)

# Dataloaderä½œæˆ
train_loader = dataloaders.get(
    name="coco_format_detection", dataset=train_dataset, batch_size=8, num_workers=4, shuffle=True
)
val_loader = dataloaders.get(
    name="coco_format_detection", dataset=val_dataset, batch_size=8, num_workers=4, shuffle=False
)

# ãƒ¢ãƒ‡ãƒ«ä½œæˆ
model = yolo_nas_l(num_classes=2, pretrained_weights="coco")

# å­¦ç¿’å®Ÿè¡Œ
trainer.train(
    model=model,
    training_params={
        "max_epochs": 30,
        "initial_lr": 0.01,
        "loss": PPYoloELoss(),
        "metric": DetectionMetrics(num_classes=2),
        "train_loader": train_loader,
        "valid_loader": val_loader,
        "save_checkpoints": True,
        "checkpoint_dir": "checkpoints/",
    },
)


â¸»

ğŸ” æ¨è«–ã‚³ãƒ¼ãƒ‰

from super_gradients.training.models import get
from super_gradients.training.utils.predict import predict
from PIL import Image

# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ï¼ˆä¿å­˜ã—ãŸãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰
model = get("yolo_nas_l", num_classes=2)
model.load_weights("checkpoints/ckpt_best.pth")  # ä¿å­˜ã•ã‚ŒãŸé‡ã¿ãƒ‘ã‚¹

# æ¨è«–ç”»åƒ
image = Image.open("sample.jpg")

# æ¨è«–
predictions = predict(model=model, images=[image], class_names=["person", "car"])
predictions.show()


â¸»

ğŸ’¡ å‚™è€ƒ
	â€¢	super-gradientsã¯å…¬å¼ãŒYOLO-NASå°‚ç”¨ã«ç”¨æ„ã—ã¦ã„ã‚‹ãŸã‚ã€PyTorchãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ãªã£ã¦ã„ã¾ã™ã€‚
	â€¢	ç‹¬è‡ªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ã†å ´åˆã¯ã€COCOFormatDetectionDatasetã‚„DetectionDatasetã‚’ä½¿ã£ã¦å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

â¸»

äº†è§£ã—ã¾ã—ãŸã€‚YOLO-NAS ã‚’ YOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ ã§å­¦ç¿’ãƒ»æ¨è«–ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«æç¤ºã—ã¾ã™ã€‚

â¸»

ğŸ“ YOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ xxx.jpg
â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ xxx.txt  â† YOLOå½¢å¼ (class_id cx cy w h)
â”œâ”€â”€ valid/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ labels/

å„ .txt ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç”»åƒã¨åŒåã§ã€è¡Œã”ã¨ã« class_id cx cy w hï¼ˆæ­£è¦åŒ–æ¸ˆã¿, å€¤ã¯0ã€œ1ï¼‰

â¸»

ğŸ§  å­¦ç¿’ã‚³ãƒ¼ãƒ‰ï¼ˆYOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰

from super_gradients.training import Trainer
from super_gradients.training.models import yolo_nas_l
from super_gradients.training.dataloaders.dataloaders import yolo_detection_train_dataloader, yolo_detection_val_dataloader
from super_gradients.training.losses import PPYoloELoss
from super_gradients.training.metrics import DetectionMetrics

# ã‚¯ãƒ©ã‚¹å®šç¾©ï¼ˆé †åºã¯YOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«åˆã‚ã›ã‚‹ï¼‰
classes = ["person", "car"]

# ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã®åˆæœŸåŒ–
trainer = Trainer(experiment_name="yolo_nas_yolo_format")

# Dataloader ä½œæˆï¼ˆYOLOå½¢å¼ï¼‰
train_dataloader = yolo_detection_train_dataloader(
    dataset_params={
        "data_dir": "dataset/train/images",
        "labels_dir": "dataset/train/labels",
        "class_names": classes,
        "input_dim": (640, 640),
    },
    dataloader_params={
        "batch_size": 8,
        "num_workers": 4,
        "shuffle": True,
    }
)

val_dataloader = yolo_detection_val_dataloader(
    dataset_params={
        "data_dir": "dataset/valid/images",
        "labels_dir": "dataset/valid/labels",
        "class_names": classes,
        "input_dim": (640, 640),
    },
    dataloader_params={
        "batch_size": 8,
        "num_workers": 4,
        "shuffle": False,
    }
)

# ãƒ¢ãƒ‡ãƒ«å®šç¾©
model = yolo_nas_l(num_classes=len(classes), pretrained_weights="coco")

# å­¦ç¿’å®Ÿè¡Œ
trainer.train(
    model=model,
    training_params={
        "max_epochs": 30,
        "initial_lr": 0.01,
        "loss": PPYoloELoss(),
        "metric": DetectionMetrics(num_classes=len(classes)),
        "train_loader": train_dataloader,
        "valid_loader": val_dataloader,
        "save_checkpoints": True,
        "checkpoint_dir": "checkpoints_yolo_format/",
    },
)


â¸»

ğŸ” æ¨è«–ã‚³ãƒ¼ãƒ‰ï¼ˆYOLOãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå­¦ç¿’æ¸ˆãƒ¢ãƒ‡ãƒ«ï¼‰

from super_gradients.training.models import get
from super_gradients.training.utils.predict import predict
from PIL import Image

# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
model = get("yolo_nas_l", num_classes=2)
model.load_weights("checkpoints_yolo_format/ckpt_best.pth")

# ç”»åƒèª­ã¿è¾¼ã¿ã¨æ¨è«–
image = Image.open("sample.jpg")
predictions = predict(model=model, images=[image], class_names=["person", "car"])
predictions.show()


â¸»

âœ… è£œè¶³ãƒã‚¤ãƒ³ãƒˆ
	â€¢	å­¦ç¿’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒãƒƒãƒã‚µã‚¤ã‚ºãƒ»å­¦ç¿’ç‡ãªã©ï¼‰ã¯ç’°å¢ƒã«å¿œã˜ã¦èª¿æ•´ã€‚
	â€¢	å…¥åŠ›ç”»åƒã‚µã‚¤ã‚ºï¼ˆ640x640ãªã©ï¼‰ã¯ãƒ¢ãƒ‡ãƒ«ã«åˆã‚ã›ã¦æŒ‡å®šï¼ˆinput_dimï¼‰ã€‚
	â€¢	æ¨è«–å¾Œã® .show() ã®ä»–ã« .save() ã§ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã‚‚å¯èƒ½ã€‚

â¸»

